<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="baidu-site-verification" content="1EB8XoOl0C"><meta name="google-site-verification" content="K7thEgdLm0UfRWJ5MGdF7sCcjClSzAlxFLPv2Oz5CGM"><title>Hexo</title><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content=""><meta name="keywords"><meta name="author" content="Lovelyun"><link rel="short icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/bubuzou.css"><link rel="search" type="application/opensearchdescription+xml" href="http://example.com/atom.xml" title="Hexo"><script src='//unpkg.com/valine/dist/Valine.min.js'></script><meta name="generator" content="Hexo 7.2.0"><link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
</head><body><header><div class="header row"><ul id="nav_list" class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" data-hover="博文" class="nav-list-link">博文</a></li><li class="nav-list-item"><a href="/archives/" target="_self" data-hover="归档" class="nav-list-link">归档</a></li></ul><div class="search"><a id="search_btn" href="#search"></a></div><div id="nav_btn" class="nav-btn"><span></span><span></span><span></span></div></div></header><div class="row scroll-con"><section class="container"><!-- for archive page--><ul class="home post-list"><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/doc/hexo%E5%8D%9A%E5%AE%A2/" class="post-title-link">hexo博客</a></h2><div class="post-info">2018-11-26<p id="busuanzi_container_page_pv" class="visit"><span id="busuanzi_value_page_pv"></span><span>次访问</span></p></div><div class="post-content"><h2 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h2><h3 id="写博客"><a href="#写博客" class="headerlink" title="写博客"></a>写博客</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new 博客标题</span><br></pre></td></tr></table></figure>

<h3 id="本地服务"><a href="#本地服务" class="headerlink" title="本地服务"></a>本地服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo serve</span><br></pre></td></tr></table></figure>

<p><img src="/../images/2018/serve.png" alt="serve"></p>
<h3 id="构建并发布"><a href="#构建并发布" class="headerlink" title="构建并发布"></a><del>构建并发布</del></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo g -d // hexo generate --deploy的简写</span><br></pre></td></tr></table></figure>

<h3 id="版本控制与持续集成"><a href="#版本控制与持续集成" class="headerlink" title="版本控制与持续集成"></a>版本控制与持续集成</h3><p>使用了上面的构建并发布流程后，你一定会觉得这个过程很麻烦，而且源文件不方便管理，虽然可以开一个分支放源文件，但还是很麻烦对不对？下面来看一个更好的处理办法，新的push出现时自动构建并发布：<br>1、Content Repo：Hexo生成出来的静态网站放到GitHub Pages时用到的repo;<br>2、Source Repo：hexo源文件的repo；<br>3、使用CI工具（比如<a target="_blank" rel="noopener" href="https://www.appveyor.com/">AppVeyor官网</a>）来完成下面的功能：<br>当有新的change push到Source Repo时，自动执行CI脚本，生成最新的静态网站发布到Content Repo。</p>
<blockquote>
<p>使用AppVeyor来建立CI的方法参考本文第二个参考链接。</p>
</blockquote>
<h2 id="个性化"><a href="#个性化" class="headerlink" title="个性化"></a>个性化</h2><h3 id="文章链接"><a href="#文章链接" class="headerlink" title="文章链接"></a>文章链接</h3><p>更改<code>_config.yml</code>中的下列配置：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">permalink: :category/:title/</span><br></pre></td></tr></table></figure>

<h3 id="图片资源处理"><a href="#图片资源处理" class="headerlink" title="图片资源处理"></a>图片资源处理</h3><p>放在 source&#x2F;images 文件夹中。然后通过 <code>![](/images/image.jpg)</code> 的方法访问它们。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![hexo serve](/img/serve.png) // 上面hexo serve的图片写法</span><br></pre></td></tr></table></figure>

<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/docs/">文档 | Hexo</a></li>
<li><a target="_blank" rel="noopener" href="https://formulahendry.github.io/2016/12/04/hexo-ci/">Hexo的版本控制与持续集成 | formulahendry</a></li>
</ul>
</div><a href="/doc/hexo%E5%8D%9A%E5%AE%A2/" class="read-more">...more</a></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/git/git%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/" class="post-title-link">git常用操作</a></h2><div class="post-info">2018-11-23<p id="busuanzi_container_page_pv" class="visit"><span id="busuanzi_value_page_pv"></span><span>次访问</span></p></div><div class="post-content"><h2 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h2><p><a target="_blank" rel="noopener" href="https://gitforwindows.org/">下载git bash</a><br><a target="_blank" rel="noopener" href="http://meldmerge.org/">下载meld</a></p>
<h2 id="基础配置"><a href="#基础配置" class="headerlink" title="基础配置"></a>基础配置</h2><p>新建.gitconfig和meld.sh文件放到C:\Users\win</p>
<p>.gitconfig文件内容如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[user]</span><br><span class="line">  email = youremail@xxx.xx</span><br><span class="line">  name = yourname</span><br><span class="line">[gui]</span><br><span class="line">  encoding = UTF-8</span><br><span class="line">[core]</span><br><span class="line">  autocrlf = <span class="literal">true</span></span><br><span class="line">[color]</span><br><span class="line">  ui = auto</span><br><span class="line">[branch]</span><br><span class="line">  autosetuprebase = always</span><br><span class="line">[<span class="built_in">alias</span>]</span><br><span class="line">  st = status</span><br><span class="line">  ci = commit</span><br><span class="line">  co = checkout</span><br><span class="line">  br = branch</span><br><span class="line">  rb = reset --hard ORIG_HEAD</span><br><span class="line">  unstage = reset HEAD</span><br><span class="line">  lg = <span class="built_in">log</span> --graph --oneline --decorate</span><br><span class="line">  last = <span class="built_in">log</span> --graph --oneline --decorate origin/master..HEAD</span><br><span class="line">[merge]</span><br><span class="line">  tool = meld</span><br><span class="line">[diff]</span><br><span class="line">  external = C:/Users/win/meld.sh</span><br></pre></td></tr></table></figure>

<p>meld.sh文件内容如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">meld <span class="variable">$2</span> <span class="variable">$5</span></span><br></pre></td></tr></table></figure>

<h2 id="升级配置"><a href="#升级配置" class="headerlink" title="升级配置"></a>升级配置</h2><h3 id="设置SSH-Key"><a href="#设置SSH-Key" class="headerlink" title="设置SSH Key"></a>设置SSH Key</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#生成公钥</span></span><br><span class="line">ssh-keygen -t rsa -C <span class="string">&quot;youremail@xxx.xx&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看公钥（复制公钥后到git仓库公钥管理页面添加key）</span></span><br><span class="line"><span class="built_in">cat</span> ~/.ssh/id_rsa.pub</span><br><span class="line"></span><br><span class="line"><span class="comment">#验证是否添加成功</span></span><br><span class="line">ssh -T git@xxx.xxx.xxx</span><br><span class="line"><span class="comment">#Welcome to GitLab, xx! // 成功会出现这行欢迎</span></span><br></pre></td></tr></table></figure>

<h3 id="多个ssh-key的管理"><a href="#多个ssh-key的管理" class="headerlink" title="多个ssh-key的管理"></a>多个ssh-key的管理</h3><p>假设你已经完成了上面的步骤，现在要给github添加一个用户和ssh-key。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#生成公钥</span></span><br><span class="line">ssh-keygen -t rsa -C <span class="string">&quot;youremail@gmail.com&quot;</span></span><br></pre></td></tr></table></figure>

<p>现在进入.ssh目录，比如我的电脑用户名是win，我的目录就是C:\Users\win.ssh，把刚刚生成的id_rsa_github和id_rsa_github.pub都放进来。<br>新建config文件，内容如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Host github.com</span><br><span class="line">  HostName github.com</span><br><span class="line">  IdentityFile C:\\Users\\win\\.ssh\\id_rsa_github</span><br><span class="line">  PreferredAuthentications publickey</span><br><span class="line">  User youremail@gmail.com</span><br></pre></td></tr></table></figure>

<p>现在.ssh目录结构如下：<img src="/../images/2018/ssh.png" alt="ssh"></p>
<p>现在本地都配置完毕，去github添加刚刚生成的id_rsa_github.pub。然后验证ssh-key是否都添加成功。</p>
<p>因为有多个用户了，上面的.gitconfig全局配置了用户信息。那么在特殊项目，就需要局部设置用户信息：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#局部配置，优先使用局部配置,如果没有局部配置，默认用全局配置</span></span><br><span class="line"><span class="built_in">cd</span> ~/workspace/github_project/</span><br><span class="line">git config user.name <span class="string">&#x27;yourename&#x27;</span></span><br><span class="line">git config user.email <span class="string">&#x27;youremail@gmail.com&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="解决LF和CRLF问题"><a href="#解决LF和CRLF问题" class="headerlink" title="解决LF和CRLF问题"></a>解决LF和CRLF问题</h3><p>推荐使用方法2。</p>
<p>1、.gitconfig文件里的autocrlf设置为true</p>
<blockquote>
<p>true会在git commit的时候自动把commit的内容里的CRLF转成LF，保证远端代码都是LF</p>
</blockquote>
<p>2、vscode用户，在USER SETTINGS里增加配置项”files.eol”: “\n”</p>
<blockquote>
<p>files.eol配置项含义：The default end of line character. Use \n for LF and \r\n for CRLF.</p>
</blockquote>
<p>3、vscode安装插件，保存是自动转换成LF。比如EditorConfig for VS Code.</p>
<h3 id="统一commit-message格式"><a href="#统一commit-message格式" class="headerlink" title="统一commit message格式"></a>统一commit message格式</h3><p>根据 angular 规范提交 commit， 这样 history 看起来更加清晰，还可以自动生成 changelog。</p>
<p>提交 commit 的类型，包括以下几种：</p>
<ul>
<li>feat: 新功能</li>
<li>fix: 修复问题</li>
<li>docs: 修改文档</li>
<li>style: 修改代码格式(空格、换行、分号等)，不影响代码逻辑</li>
<li>refactor: 重构代码（既不是修复bug，也不是增加新特性），理论上不影响现有功能</li>
<li>perf: 提升性能</li>
<li>test: 增加修改测试用例</li>
<li>chore: 修改工具相关（包括但不限于文档、代码生成等）</li>
<li>deps: 升级依赖,修改版本号</li>
</ul>
<p>还可以借助插件来写符合规范的message:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Making your repo Commitizen-friendly</span></span><br><span class="line"><span class="comment"># For this example, we&#x27;ll be setting up our repo to use AngularJS&#x27;s commit message convention also known as conventional-changelog.</span></span><br><span class="line"><span class="comment"># First, install the Commitizen cli tools:</span></span><br><span class="line">npm install commitizen -g</span><br><span class="line"></span><br><span class="line"><span class="comment"># Next, initialize your project to use the cz-conventional-changelog adapter by typing:</span></span><br><span class="line">commitizen init cz-conventional-changelog --save-dev --save-exact</span><br><span class="line"></span><br><span class="line"><span class="comment"># commit codes(use git cz to instead git commit)</span></span><br><span class="line"><span class="comment"># For detailed explanation on how things work, checkout the [guide](https://github.com/commitizen/cz-cli).</span></span><br><span class="line">git cz</span><br></pre></td></tr></table></figure>

<h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><h3 id="基础操作"><a href="#基础操作" class="headerlink" title="基础操作"></a>基础操作</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># init</span></span><br><span class="line">git <span class="built_in">clone</span> git@git.xxx.xx:xx/xxx.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># add codes</span></span><br><span class="line">git add</span><br><span class="line"></span><br><span class="line"><span class="comment"># push codes</span></span><br><span class="line">git push origin feature-name</span><br><span class="line"></span><br><span class="line"><span class="comment"># new branch</span></span><br><span class="line">git checkout master</span><br><span class="line">git checkout -b feature-new</span><br><span class="line"></span><br><span class="line"><span class="comment"># merge branches(use rebase to instead merge)</span></span><br><span class="line"><span class="comment"># For example, merge feature-new to master(please make master up-to-date with &#x27;origin/master&#x27; at first)</span></span><br><span class="line">git checkout feature-new</span><br><span class="line">git rebase master</span><br><span class="line">git checkout master</span><br><span class="line">git rebase feature-new</span><br></pre></td></tr></table></figure>

<h3 id="tag"><a href="#tag" class="headerlink" title="tag"></a>tag</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#新建标签</span></span><br><span class="line">git tag v1.0 // 打在最近的commit上</span><br><span class="line">git tag v0.9 f52c633 // 打在f52c633上</span><br><span class="line">git tag -a v0.9 -m <span class="string">&quot;blablabla...&quot;</span> // 指定标签信息</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看标签</span></span><br><span class="line">git tag // 查看所有标签</span><br><span class="line">git show v0.9 // 查看单个标签，可以看到标签信息</span><br><span class="line"></span><br><span class="line"><span class="comment">#删除标签</span></span><br><span class="line">git tag -d v0.1 //删除本地标签</span><br><span class="line">git push origin :refs/tags/v0.1 //删除远程标签</span><br><span class="line"></span><br><span class="line"><span class="comment">#推送标签</span></span><br><span class="line">git push origin v1.0 // 推送单个标签</span><br><span class="line">git push origin --tags // 推送所有标签</span><br></pre></td></tr></table></figure>
</div><a href="/git/git%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/" class="read-more">...more</a></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/js/Promise%E6%80%BB%E7%BB%93/" class="post-title-link">Promise总结</a></h2><div class="post-info">2018-10-15<p id="busuanzi_container_page_pv" class="visit"><span id="busuanzi_value_page_pv"></span><span>次访问</span></p></div><div class="post-content"><h2 id="Promise简介"><a href="#Promise简介" class="headerlink" title="Promise简介"></a>Promise简介</h2><p>Promise对象用于表示一个异步操作的最终状态（完成或失败），以及其返回的值。由浏览器直接支持。</p>
<p>打开Chrome的控制台输入<code>new Promise(function () &#123;&#125;);</code>后可以看到浏览器的Promise对象:<img src="/../images/2018/promise1.png" alt="promise"></p>
<p>下面创建一个Promise:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span>(<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">  <span class="comment">// executor (the producing code, &quot;singer&quot;)</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>传给new Promise作为参数的函数叫做executor。Promise创建后自动运行。</p>
<p>promise有两个内部变量：<br>1、state — 初始值pending, 会变成fulfilled或rejected。<br>2、result — 初始值undefined，代码运行后的任意值。</p>
<p>当executor运作完毕，会执行它两个参数中的一个函数：</p>
<p>resolve(value) - 代表executor运作结果是成功的，并且：<br>1、把state变成fulfilled；<br>2、把result变成value。<br>reject(error) - 代表executor运作出错，并且：<br>1、把state变成rejected；<br>2、把result变成error。</p>
<p><img src="/../images/2018/promise-resolve-reject.png" alt="promise-resolve-reject"></p>
<p>Promise状态是resolved或rejected时叫做settled。</p>
<p>上面说到executor运行完毕会执行resolve或reject，其实executor只会执行一次resolve或reject，并且result改变后不能再改变。resolve&#x2F;reject只会接收1个参数，后续的都会被忽略。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span>(<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">  <span class="title function_">resolve</span>(<span class="string">&quot;done&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;…&quot;</span>)); <span class="comment">// ignored</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="string">&quot;…&quot;</span>)); <span class="comment">// ignored</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<div class="tip">
reject的参数推荐使用Error对象。
</div>

<h2 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h2><h3 id="1、处理-rejection"><a href="#1、处理-rejection" class="headerlink" title="1、处理 rejection"></a>1、处理 rejection</h3><p>有两种方式去处理 rejection</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Whoops!&quot;</span>)), <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// .catch(f) is the same as promise.then(null, f)</span></span><br><span class="line">promise.<span class="title function_">catch</span>(alert); <span class="comment">// shows &quot;Error: Whoops!&quot; after 1 second</span></span><br></pre></td></tr></table></figure>

<div class="tip">
.catch(f) 只是 .then(null, f)的简写。
</div>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 方式一</span></span><br><span class="line">promise.<span class="title function_">then</span>(f1, f2);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方式二</span></span><br><span class="line">promise.<span class="title function_">then</span>(f1).<span class="title function_">catch</span>(f2);</span><br></pre></td></tr></table></figure>

<div class="tip">
注意方式一和二的不同：f1发生的错误只会在方式二的catch中处理。
</div>

<h3 id="2、Unhandled-rejections"><a href="#2、Unhandled-rejections" class="headerlink" title="2、Unhandled rejections"></a>2、Unhandled rejections</h3><p>发生错误时，Promise状态变成reject，execution跳转到最近的rejection handler，如果没有rejection handler，错误就会变成stuck。<br>比如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">noSuchFunction</span>(); <span class="comment">// Error here (no such function)</span></span><br><span class="line">&#125;); <span class="comment">// no .catch attached</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// catch ReferenceError: b is not defined</span></span><br></pre></td></tr></table></figure>

<p>或者：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a chain of promises without .catch at the end</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Whoops!&quot;</span>);</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// ...something...</span></span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// ...something else...</span></span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// ...but no catch after it!</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>大多数js引擎会全局处理这种错误，我们可以在console中看到。</p>
<div class="tip">
要尽量避免出现Unhandled rejections，可以在promise调用链末尾增加catch。
</div>

<h3 id="3、触发Promise异常"><a href="#3、触发Promise异常" class="headerlink" title="3、触发Promise异常"></a>3、触发Promise异常</h3><ul>
<li>主动调用 reject 方法</li>
<li>抛出异常（exception）</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  a = b;</span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;catch&#x27;</span>, val);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// catch ReferenceError: b is not defined</span></span><br></pre></td></tr></table></figure>

<h3 id="4、链式调用"><a href="#4、链式调用" class="headerlink" title="4、链式调用"></a>4、链式调用</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="string">&#x27;成功1&#x27;</span>);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;then1&#x27;</span>, val);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;成功2&#x27;</span></span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;then2&#x27;</span>, val);</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="string">&#x27;成功3&#x27;</span>)</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;then3&#x27;</span>, val);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;成功4&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// then1 成功1</span></span><br><span class="line"><span class="comment">// then2 成功2</span></span><br><span class="line"><span class="comment">// then3 成功3</span></span><br></pre></td></tr></table></figure>

<div class="tip">
注意then的返回值，链式调用时，前一个then的返回值决定后一个then的val。 通常而言，如果你不知道一个值是否是Promise对象，使用Promise.resolve(value) 来返回一个Promise对象,这样就能将该value以Promise对象形式使用。
</div>

<h3 id="5、-then-catch是异步的"><a href="#5、-then-catch是异步的" class="headerlink" title="5、.then&#x2F;.catch是异步的"></a>5、.then&#x2F;.catch是异步的</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;javascript start&#x27;</span>);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;setTimeout&#x27;</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;promise1&#x27;</span>);</span><br><span class="line">  <span class="title function_">resolve</span>();</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;promise2&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;javascript end&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// javascript start</span></span><br><span class="line"><span class="comment">// promise1</span></span><br><span class="line"><span class="comment">// javascript end</span></span><br><span class="line"><span class="comment">// promise2</span></span><br><span class="line"><span class="comment">// setTimeout</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">  <span class="title function_">resolve</span>(<span class="string">&#x27;b&#x27;</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;c&#x27;</span>)</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// a c b</span></span><br></pre></td></tr></table></figure>

<p>构造函数中的executor执行是同步的，输出 a, 执行 resolve 函数，将 Promise 对象状态置为 resolved，输出 c。同时注册这个 Promise 对象的回调 then 函数。整个脚本执行完，stack 清空。event loop 检查到 stack 为空，再检查 microtask 队列中是否有任务，发现了 Promise 对象的 then 回调函数产生的 microtask，推入 stack，执行。输出 b，event loop的列队为空，stack 为空，脚本执行完毕。</p>
<p>microtask：在当前 task 执行完，准备进行 I&#x2F;O，repaint，redraw 等原生操作之前，需要执行一些低延迟的异步操作(microtask)，使得浏览器渲染和原生运算变得更加流畅。假如每执行一个异步操作都要重新生成一个 task，将提高宿主平台的负担和响应时间。所以，需要有一个概念，在进行下一个 task 之前，将当前 task 生成的低延迟的，与下一个 task 无关的异步操作执行完，这就是 microtask。</p>
<p>原生的setTimeout就算是将延迟设置为 0 也会有 4 ms 的延迟，会将一个完整的 task 放进队列延迟执行，而且每个 task 之间会进行渲染等原生操作。</p>
<p>Promise 所说的异步执行，只是将 Promise 构造函数中 resolve，reject 方法和注册的 callback 转化为 eventLoop的 microtask&#x2F;Promise Job，并放到 Event Loop 队列中等待执行，也就是Javascript单线程中的“异步执行”。</p>
<h3 id="Promise实现原理"><a href="#Promise实现原理" class="headerlink" title="Promise实现原理"></a>Promise实现原理</h3><p>自行阅读参考的后3个链接</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise - JavaScript | MDN</a></li>
<li><a target="_blank" rel="noopener" href="https://javascript.info/async">Promises, async&#x2F;await</a></li>
<li><a target="_blank" rel="noopener" href="https://promisesaplus.com/#point-67">Promises&#x2F;A+</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/xieranmaya/blog/issues/3">剖析Promise内部结构，一步一步实现一个完整的、能通过所有Test case的Promise类 · Issue #3 · xieranmaya&#x2F;blog</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/23312442">写一个符合 Promises&#x2F;A+ 规范并可配合 ES7 async&#x2F;await 使用的 Promise - 知乎</a></li>
</ul>
</div><a href="/js/Promise%E6%80%BB%E7%BB%93/" class="read-more">...more</a></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/doc/markdown%E6%A6%82%E8%A6%81/" class="post-title-link">Markdown常用语法手册</a></h2><div class="post-info">2018-10-12<p id="busuanzi_container_page_pv" class="visit"><span id="busuanzi_value_page_pv"></span><span>次访问</span></p></div><div class="post-content"><h2 id="常用语法"><a href="#常用语法" class="headerlink" title="常用语法"></a>常用语法</h2><h3 id="1-斜体和粗体"><a href="#1-斜体和粗体" class="headerlink" title="1. 斜体和粗体"></a>1. 斜体和粗体</h3><p>这是 <em>斜体</em>，这是 <strong>粗体</strong>。</p>
<h3 id="2-分级标题"><a href="#2-分级标题" class="headerlink" title="2. 分级标题"></a>2. 分级标题</h3><p>在行首加井号表示不同级别的标题 (H1-H6)，例如：## H2, ### H3</p>
<h3 id="3-外链"><a href="#3-外链" class="headerlink" title="3. 外链"></a>3. 外链</h3><p>这是去往 <a target="_blank" rel="noopener" href="https://lovelyun.github.io/">本人博客</a> 的链接。</p>
<h3 id="4-无序列表"><a href="#4-无序列表" class="headerlink" title="4. 无序列表"></a>4. 无序列表</h3><ul>
<li>无序列表项 一</li>
<li>无序列表项 二</li>
</ul>
<h3 id="5-有序列表"><a href="#5-有序列表" class="headerlink" title="5. 有序列表"></a>5. 有序列表</h3><ol>
<li>有序列表项 一</li>
<li>有序列表项 二</li>
</ol>
<h3 id="6-文字引用"><a href="#6-文字引用" class="headerlink" title="6. 文字引用"></a>6. 文字引用</h3><blockquote>
<ul>
<li>整理知识，学习笔记</li>
<li>发布日记，杂文，所见所想</li>
</ul>
</blockquote>
<hr>
<blockquote>
<p>野火烧不尽，春风吹又生。</p>
</blockquote>
<div class="tip">
野火烧不尽，春风吹又生。
</div>

<h3 id="7-行内代码块"><a href="#7-行内代码块" class="headerlink" title="7. 行内代码块"></a>7. 行内代码块</h3><p>让我们聊聊 <code>html</code>。</p>
<h3 id="8-代码块"><a href="#8-代码块" class="headerlink" title="8. 代码块"></a>8. 代码块</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* nth element in the fibonacci series.</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> n &gt;= 0</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> the nth element, &gt;= 0.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fib</span>(<span class="params">n</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> a = <span class="number">1</span>, b = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">var</span> tmp;</span><br><span class="line">  <span class="keyword">while</span> (--n &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">    tmp = a;</span><br><span class="line">    a += b;</span><br><span class="line">    b = tmp;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="9-插入图像"><a href="#9-插入图像" class="headerlink" title="9. 插入图像"></a>9. 插入图像</h3><p><img src="https://avatars0.githubusercontent.com/u/11694024?s=460&v=4" alt="我的头像"></p>
<h3 id="10-删除线"><a href="#10-删除线" class="headerlink" title="10. 删除线"></a>10. 删除线</h3><p><del>这是一段错误的文本。</del></p>
<h3 id="11-绘制表格"><a href="#11-绘制表格" class="headerlink" title="11. 绘制表格"></a>11. 绘制表格</h3><table>
<thead>
<tr>
<th>Syntax</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>Header</td>
<td>Title</td>
</tr>
<tr>
<td>Paragraph</td>
<td>Text</td>
</tr>
</tbody></table>
<p>使用<code>:</code>对齐</p>
<table>
<thead>
<tr>
<th align="left">Syntax</th>
<th align="center">Description</th>
<th align="right">Test Text</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Header</td>
<td align="center">Title</td>
<td align="right">Here’s this</td>
</tr>
<tr>
<td align="left">Paragraph</td>
<td align="center">Text</td>
<td align="right">And more</td>
</tr>
</tbody></table>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><p><a target="_blank" rel="noopener" href="https://markdown.com.cn/cheat-sheet.html#%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95">Markdown 语法速查表</a></p>
</div><a href="/doc/markdown%E6%A6%82%E8%A6%81/" class="read-more">...more</a></article></li></ul><div class="right-container"><div class="widget"><div class="category"><h4>分类归档</h4><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/ai/">ai</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/css/">css</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/doc/">doc</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/js/">js</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/node/">node</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%8A%A8%E6%95%88/">动效</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/">图像处理</a><span class="category-list-count">13</span></li></ul></div></div><div class="widget"><div class="tagcloud"><h4>标签云</h4></div></div><div class="widget"><div class="recent"><h4>最近文章</h4><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/js/js%E9%81%8D%E5%8E%86%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/">js遍历那些事儿</a></li><li class="post-list-item"><a class="post-list-link" href="/css/%E8%AF%A6%E8%A7%A3CSS%20Grid%E5%B8%83%E5%B1%80/">详解CSS Grid布局</a></li><li class="post-list-item"><a class="post-list-link" href="/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/Shutterstock%20Editor%E5%85%B3%E4%BA%8ECanvas%E5%92%8CWebGL%E5%9B%BE%E7%89%87%E6%BB%A4%E9%95%9C%E7%9A%84%E5%AE%9E%E7%8E%B0/">Shutterstock Editor关于Canvas和WebGL图片滤镜的实现</a></li><li class="post-list-item"><a class="post-list-link" href="/js/javascript%E5%BC%82%E6%AD%A5error/">javascript异步error</a></li><li class="post-list-item"><a class="post-list-link" href="/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/win10%E7%BC%96%E8%AF%91opencvjs/">win10编译opencvjs</a></li></ul></div></div></div></section></div><div class="right-menu"></div><div class="modal search-modal"><div class="input-field"><input type="text" id="search_input"><label for="search-input">搜索</label></div><div id="search_result" class="search-result"></div></div><div class="blog-overlay"></div><footer class="row"><div class="footer-con"><div class="paginator"><a href="/page/4/" class="prev">PREV</a></div><div class="copyright"><p>© 2018 - 2024 <a href="https://github.com/lovelyun" target="_blank">Lovelyun</a></p></div><div class="totop"><i></i></div></div></footer><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script src="https://apps.bdimg.com/libs/jquery/1.8.2/jquery.min.js"></script><script src="https://bubuzou.oss-cn-shenzhen.aliyuncs.com/blog/202010/articleCatalog.js"></script><script src="https://bubuzou.oss-cn-shenzhen.aliyuncs.com/blog/202010/main.js"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>